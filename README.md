# TEUFEL
THz Emission from Undulators and Free-Electron Lasers
=======================================

This is a C++ project to support tracking of charged particles in
arbitrary external fields and to compute the electromagnetic radiation
emitted by these particles using the Li√©nard-Wiechert formula.

The particles are distributed over several compute nodes which comminicate
using OpenMPI. In this computing model a Bunch() is an ensemble of particles
residing on a single compute node. The Beam() comprises all bunches (and thus all particles).
Within the Beam() object all MPI communication is handled.

Every particle stores its full trajectory data. All field computation is done
after the tracking is finished.

Functionality
-------------
- particle tracking using different pusher algorithms (Euler, Vay)<br>
  see \ref ChargedParticle
- radiation emission towards a single observation point
- several external field objects (homogeneous dipole, planar undulator ...)

Build and Installation
----------------------

A few libraries are required to build the TEUFEL executable.
- To simplify building TEUFEL version 3.4 of the the [SDDS toolkit](https://ops.aps.anl.gov/SDDSInfo.shtml)
  is contained in the repository.
- On most systems the [HDF5 library](https://support.hdfgroup.org/HDF5/) can be installed
  from the distribution repositories.<br>
  It is necessary to set an environment variable for the library to be found by the build system<br>
  ```export HDF5_ROOT=_path_to_library```

We are using the cmake build system to allow an easy build on a variety of platforms.
Here we describe a typical out-of-source build.
First one should obtain the sources by cloning the repository from Github.
```
git clone http://github.com/lehnertu/teufel.git
cd teufel
```
Then we create a build directory in the downloaded source directory.
```
mkdir build
cd build
```
Then we build the makefile from CMakeLists.txt contained in the root directory.
```
cmake ..
```
One can check the libraries and tools found and change the make options.
This can be usefull if it is desired to build the documentation by default
or to skip the build of the test executables (enabled by default).
```
ccmake ..
```
After that 
```
make
```
creates the executable in the build directory.

Documentation
-------------

We aim at fully documenting the code for easy reuse and maintenance.
The documentation can be built using doxygen.

```make docs```

The documentation can then be accessed with a browser starting from `doc/html/index.html`.

Testcases
---------

A number of test cases is provided which serve both for code benchmarking
against known results and as coding examples. All tests are built by default
in the build directory. For running all the checks in sequence,
right away from the build directory, a script is provided in the main folder:

```./run_tests```

- circular trajectory of an electron in a homogeneous dipole magnet - tests/teufel.magnet.cpp
- single-electron trajectory in a planar undulator - tests/teufel.undulator.cpp
- field generated by an electron in circular motion at the center of the trajectory - tests/teufel.loop.cpp
- straight trajectory in crossed electric and magnetic fields - tests/teufel.EcrossB.cpp

To check for memory leaks the tool [Valgrind](http://valgrind.org) is recommended.

```valgrind --tool=memcheck tests/teufel.xxx```

For some testcases and examples python scripts for visualizing the data are
provided in the scrips/ directory. For reading HDF5 files these scripts use the
[h5py](http://www.h5py.org/) library which can be installed from the "python-h5py" package on most Linux systems.
